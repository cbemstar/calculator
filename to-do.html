<!DOCTYPE html>
<html>
<head>
    <title>To-Do List</title>
    <style>
        /* ... (existing styles) ... */
    </style>
</head>
<body onload="loadTasks()"> 
    <h1>To-Do List</h1>

    <div class="input-container">
        </div>

    <ul id="taskList"></ul>

    <script>
        const taskList = document.getElementById('taskList');

        function addTask() {
            // ... (get input values) ... 

            const task = {
                clientName: clientName,
                jobNumber: jobNumber,
                taskDescription: taskDescription,
                reminder: reminder,
                completed: false,
                comments: "" 
            };

            const tasks = getTasks();
            tasks.push(task);
            saveTasks(tasks);

            renderTasks(); // Re-render the task list

            // ... (clear input fields) ... 
        }

        function deleteTask(button) {
            const tasks = getTasks();
            const taskIndex = Array.from(taskList.children).indexOf(button.parentElement);
            tasks.splice(taskIndex, 1);
            saveTasks(tasks);
            renderTasks();
        }

        function completeTask(button) {
            const tasks = getTasks();
            const taskIndex = Array.from(taskList.children).indexOf(button.parentElement);
            tasks[taskIndex].completed = !tasks[taskIndex].completed;
            saveTasks(tasks);
            renderTasks();
        }

        function toggleComments(button) {
            const commentsContainer = button.nextElementSibling;
            commentsContainer.style.display = commentsContainer.style.display === 'none' ? 'block' : 'none';
        }

        function getTasks() {
            const tasksJSON = localStorage.getItem('tasks');
            return tasksJSON ? JSON.parse(tasksJSON) : [];
        }

        function saveTasks(tasks) {
            localStorage.setItem('tasks', JSON.stringify(tasks));
        }

        function renderTasks() {
            taskList.innerHTML = ''; // Clear the list
            const tasks = getTasks();
            tasks.forEach((task, index) => {
                const li = document.createElement('li');
                li.classList.toggle('completed', task.completed);
                li.innerHTML = `
                    ${task.taskDescription} 
                    (Client: ${task.clientName}, Job: ${task.jobNumber}) 
                    <button class="complete-button" onclick="completeTask(this)">Complete</button>
                    <button class="delete-button" onclick="deleteTask(this)">Delete</button>
                    <button class="comments-button" onclick="toggleComments(this)">Comments</button>
                    <div class="comments-container">
                        <textarea placeholder="Add comments here..." onblur="saveComments(this, ${index})">${task.comments}</textarea>
                    </div>
                `;
                taskList.appendChild(li);
            });
        }

        function saveComments(textarea, taskIndex) {
            const tasks = getTasks();
            tasks[taskIndex].comments = textarea.value;
            saveTasks(tasks);
        }

        function loadTasks() {
            renderTasks();
        }

    </script>
</body>
</html>
